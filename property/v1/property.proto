syntax = "proto3";

package property;

// Property Service - exposed to API Gateway and other microservices
service PropertyService {
  // CRUD Operations
  rpc CreateProperty(CreatePropertyRequest) returns (PropertyResponse);
  rpc GetProperty(GetPropertyRequest) returns (PropertyResponse);
  rpc GetPropertyWithOwner(GetPropertyRequest) returns (PropertyWithOwnerResponse);
  rpc UpdateProperty(UpdatePropertyRequest) returns (PropertyResponse);
  rpc DeleteProperty(DeletePropertyRequest) returns (MessageResponse);
  rpc HardDeleteProperty(DeletePropertyRequest) returns (MessageResponse);

  // List/Query Operations
  rpc ListProperties(ListPropertiesRequest) returns (PropertiesResponse);
  rpc GetPropertiesByOwner(GetPropertiesByOwnerRequest) returns (PropertiesResponse);
  rpc SearchByLocation(SearchByLocationRequest) returns (PropertiesResponse);

  // Status Operations
  rpc UpdatePropertyStatus(UpdatePropertyStatusRequest) returns (PropertyResponse);

  // Media Operations
  rpc UpdatePropertyMedia(UpdateMediaRequest) returns (PropertyResponse);
  rpc AddPropertyMedia(UpdateMediaRequest) returns (PropertyResponse);

  // Blockchain Operations
  rpc UpdateBlockchainInfo(UpdateBlockchainRequest) returns (PropertyResponse);

  // Statistics
  rpc GetOwnerPropertyStats(GetOwnerStatsRequest) returns (OwnerStatsResponse);

  // Document Operations
  rpc CreatePropertyDocuments(CreatePropertyDocumentsRequest) returns (PropertyDocumentResponse);
  rpc GetPropertyDocuments(GetPropertyDocumentsRequest) returns (PropertyDocumentResponse);
  rpc UpdatePropertyDocument(UpdatePropertyDocumentRequest) returns (PropertyDocumentResponse);
  rpc DeletePropertyDocument(DeletePropertyDocumentRequest) returns (MessageResponse);
  rpc VerifyPropertyDocument(VerifyPropertyDocumentRequest) returns (PropertyDocumentResponse);
  rpc GetDocumentVerificationStatus(GetPropertyDocumentsRequest) returns (DocumentVerificationStatusResponse);
}

// ==================== Enums ====================

enum PropertyType {
  PROPERTY_TYPE_UNSPECIFIED = 0;
  APARTMENT = 1;
  HOUSE = 2;
  LAND = 3;
  COMMERCIAL = 4;
}

enum PropertyStatus {
  PROPERTY_STATUS_UNSPECIFIED = 0;
  AVAILABLE = 1;
  RENTED = 2;
  SOLD = 3;
  PENDING = 4;
}

enum Currency {
  CURRENCY_UNSPECIFIED = 0;
  USD = 1;
  NGN = 2;
  ETH = 3;
  USDT = 4;
}

// ==================== Core Messages ====================

message Coordinates {
  string type = 1; // "Point"
  repeated double coordinates = 2; // [longitude, latitude]
}

message NeighborhoodHighlights {
  string description = 1;
  repeated string tags = 2;
}

message PropertyLocation {
  string address = 1;
  string suite = 2;
  string city = 3;
  string state = 4;
  string country = 5;
  Coordinates coordinates = 6;
  NeighborhoodHighlights neighborhoodHighlights = 7;
}

message DimensionDetails {
  double totalArea = 1;
  double lotSize = 2;
  int32 yearBuilt = 3;
  string propertyType = 4;
}

message PropertySize {
  int32 bedrooms = 1;
  int32 bathrooms = 2;
  int32 parkingSpaces = 3;
  DimensionDetails dimensionDetails = 4;
}

message PropertyAmenities {
  repeated string comfort = 1;
  repeated string safety = 2;
  repeated string recreation = 3;
}

message MediaItem {
  string url = 1;
  string mediaId = 2;
}

message PropertyMedia {
  repeated MediaItem images = 1;
  repeated MediaItem videos = 2;
}

message BlockchainInfo {
  string nftId = 1;
  string contractAddress = 2;
  string transactionHash = 3;
}

message Property {
  string id = 1;
  string title = 2;
  string description = 3;
  string type = 4; // PropertyType as string
  string status = 5; // PropertyStatus as string
  double price = 6;
  string currency = 7; // Currency as string
  PropertyLocation location = 8;
  repeated string features = 9;
  PropertySize size = 10;
  repeated PropertyAmenities amenities = 11;
  PropertyMedia media = 12;
  string ownerId = 13;
  BlockchainInfo blockchain = 14;
  bool isActive = 15;
  string createdAt = 16;
  string updatedAt = 17;
}

message Owner {
  string userId = 1;
  string firstName = 2;
  string lastName = 3;
  string email = 4;
  string phone = 5;
  bool isVerified = 6;
}

// ==================== Request Messages ====================

message CreatePropertyRequest {
  string title = 1;
  string description = 2;
  string type = 3;
  double price = 4;
  string currency = 5;
  PropertyLocation location = 6;
  repeated string features = 7;
  PropertySize size = 8;
  repeated PropertyAmenities amenities = 9;
  PropertyMedia media = 10;
  string ownerId = 11;
}

message GetPropertyRequest {
  string propertyId = 1;
}

message UpdatePropertyRequest {
  string propertyId = 1;
  string userId = 2; // For ownership verification
  string title = 3;
  string description = 4;
  string type = 5;
  string status = 6;
  double price = 7;
  string currency = 8;
  PropertyLocation location = 9;
  repeated string features = 10;
  PropertySize size = 11;
  repeated PropertyAmenities amenities = 12;
  PropertyMedia media = 13;
}

message DeletePropertyRequest {
  string propertyId = 1;
  string userId = 2; // For ownership verification
}

message ListPropertiesRequest {
  int32 page = 1;
  int32 limit = 2;
  string sort = 3;
  // Filters
  string type = 4;
  string status = 5;
  double minPrice = 6;
  double maxPrice = 7;
  string city = 8;
  string country = 9;
  int32 bedrooms = 10;
  int32 bathrooms = 11;
  string ownerId = 12;
  bool isActive = 13;
  string search = 14;
  bool filterByActive = 15; // Set to true to apply isActive filter
}

message GetPropertiesByOwnerRequest {
  string ownerId = 1;
  int32 page = 2;
  int32 limit = 3;
  string sort = 4;
}

message SearchByLocationRequest {
  double longitude = 1;
  double latitude = 2;
  double maxDistanceKm = 3;
  int32 page = 4;
  int32 limit = 5;
}

message UpdatePropertyStatusRequest {
  string propertyId = 1;
  string userId = 2;
  string status = 3; // PropertyStatus as string
}

message UpdateMediaRequest {
  string propertyId = 1;
  string userId = 2;
  repeated string images = 3;
  repeated string videos = 4;
}

message UpdateBlockchainRequest {
  string propertyId = 1;
  string userId = 2;
  string nftId = 3;
  string contractAddress = 4;
  string transactionHash = 5;
}

message GetOwnerStatsRequest {
  string ownerId = 1;
}

// ==================== Response Messages ====================

message MessageResponse {
  bool success = 1;
  string message = 2;
}

message PropertyResponse {
  bool success = 1;
  string message = 2;
  Property property = 3;
}

message PropertyWithOwnerResponse {
  bool success = 1;
  string message = 2;
  Property property = 3;
  Owner owner = 4;
}

message PaginationInfo {
  int32 total = 1;
  int32 page = 2;
  int32 limit = 3;
  int32 totalPages = 4;
  bool hasNextPage = 5;
  bool hasPrevPage = 6;
}

message PropertiesResponse {
  bool success = 1;
  string message = 2;
  repeated Property properties = 3;
  PaginationInfo pagination = 4;
}

message OwnerStatsResponse {
  bool success = 1;
  int32 total = 2;
  int32 available = 3;
  int32 rented = 4;
  int32 sold = 5;
  int32 pending = 6;
}

// ==================== Document Messages ====================

message DocumentInfo {
  string url = 1;
  string mediaId = 2;
  bool isVerified = 3;
}

message PropertyDocument {
  string id = 1;
  string propertyId = 2;
  DocumentInfo deedDocument = 3;
  DocumentInfo inspectionReport = 4;
  DocumentInfo appraisalReport = 5;
  string createdAt = 6;
  string updatedAt = 7;
}

message CreatePropertyDocumentsRequest {
  string propertyId = 1;
  string userId = 2;
  DocumentInfo deedDocument = 3;
  DocumentInfo inspectionReport = 4;
  DocumentInfo appraisalReport = 5;
}

message GetPropertyDocumentsRequest {
  string propertyId = 1;
}

message UpdatePropertyDocumentRequest {
  string propertyId = 1;
  string userId = 2;
  string documentType = 3; // "deedDocument", "inspectionReport", "appraisalReport"
  DocumentInfo document = 4;
}

message DeletePropertyDocumentRequest {
  string propertyId = 1;
  string userId = 2;
  string documentType = 3; // "deedDocument", "inspectionReport", "appraisalReport"
}

message VerifyPropertyDocumentRequest {
  string propertyId = 1;
  string documentType = 2; // "deedDocument", "inspectionReport", "appraisalReport"
  bool isVerified = 3;
}

message PropertyDocumentResponse {
  bool success = 1;
  string message = 2;
  PropertyDocument document = 3;
}

message DocumentVerificationStatus {
  bool deedDocumentVerified = 1;
  bool inspectionReportVerified = 2;
  bool appraisalReportVerified = 3;
  bool allVerified = 4;
}

message DocumentVerificationStatusResponse {
  bool success = 1;
  string message = 2;
  DocumentVerificationStatus status = 3;
}
